[2023-04-23T13:47:21.531+0000] {taskinstance.py:1090} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: nfl_transformation_dag.task_pyspark scheduled__2023-04-11T00:00:00+00:00 [None]>
[2023-04-23T13:47:21.561+0000] {taskinstance.py:1090} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: nfl_transformation_dag.task_pyspark scheduled__2023-04-11T00:00:00+00:00 [None]>
[2023-04-23T13:47:21.563+0000] {taskinstance.py:1288} INFO - 
--------------------------------------------------------------------------------
[2023-04-23T13:47:21.565+0000] {taskinstance.py:1289} INFO - Starting attempt 30 of 32
[2023-04-23T13:47:21.566+0000] {taskinstance.py:1290} INFO - 
--------------------------------------------------------------------------------
[2023-04-23T13:47:21.595+0000] {taskinstance.py:1309} INFO - Executing <Task(_PythonDecoratedOperator): task_pyspark> on 2023-04-11 00:00:00+00:00
[2023-04-23T13:47:21.635+0000] {standard_task_runner.py:55} INFO - Started process 4666 to run task
[2023-04-23T13:47:21.709+0000] {standard_task_runner.py:82} INFO - Running: ['***', 'tasks', 'run', 'nfl_transformation_dag', 'task_pyspark', 'scheduled__2023-04-11T00:00:00+00:00', '--job-id', '1199', '--pool', 'default_pool', '--raw', '--subdir', 'DAGS_FOLDER/data_ingestion.py', '--cfg-path', '/tmp/tmpcz5ud2f2']
[2023-04-23T13:47:21.754+0000] {standard_task_runner.py:83} INFO - Job 1199: Subtask task_pyspark
[2023-04-23T13:47:22.359+0000] {task_command.py:389} INFO - Running <TaskInstance: nfl_transformation_dag.task_pyspark scheduled__2023-04-11T00:00:00+00:00 [running]> on host 235fa867d994
[2023-04-23T13:47:22.697+0000] {taskinstance.py:1516} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=***
AIRFLOW_CTX_DAG_ID=nfl_transformation_dag
AIRFLOW_CTX_TASK_ID=task_pyspark
AIRFLOW_CTX_EXECUTION_DATE=2023-04-11T00:00:00+00:00
AIRFLOW_CTX_TRY_NUMBER=30
AIRFLOW_CTX_DAG_RUN_ID=scheduled__2023-04-11T00:00:00+00:00
[2023-04-23T13:47:22.741+0000] {subprocess.py:63} INFO - Tmp dir root location: 
 /tmp
[2023-04-23T13:47:22.760+0000] {subprocess.py:75} INFO - Running command: ['/bin/bash', '-c', 'gcloud dataproc jobs submit pyspark                 --cluster=nfl-spark-cluster                 --region=europe-west6                 --jars=gs://spark-lib/bigquery/spark-bigquery-with-dependencies_2.12-0.30.0.jar                gs://nfl-data-lake_nfl-project-de/code/transform_pyspark.py                 --                     --year=2019                     --season_type=2 ']
[2023-04-23T13:47:22.813+0000] {subprocess.py:86} INFO - Output:
[2023-04-23T13:47:32.269+0000] {subprocess.py:93} INFO - Job [c46a0e44540e46869f8f684085c1ab08] submitted.
[2023-04-23T13:47:32.270+0000] {subprocess.py:93} INFO - Waiting for job output...
[2023-04-23T13:47:44.777+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.apache.spark.SparkEnv: Registering MapOutputTracker
[2023-04-23T13:47:44.779+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.apache.spark.SparkEnv: Registering BlockManagerMaster
[2023-04-23T13:47:44.780+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.apache.spark.SparkEnv: Registering BlockManagerMasterHeartbeat
[2023-04-23T13:47:44.781+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.apache.spark.SparkEnv: Registering OutputCommitCoordinator
[2023-04-23T13:47:44.782+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.sparkproject.jetty.util.log: Logging initialized @5388ms to org.sparkproject.jetty.util.log.Slf4jLog
[2023-04-23T13:47:44.783+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.sparkproject.jetty.server.Server: jetty-9.4.40.v20210413; built: 2021-04-13T20:42:42.668Z; git: b881a572662e1943a14ae12e7e1207989f218b74; jvm 1.8.0_322-b06
[2023-04-23T13:47:44.785+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.sparkproject.jetty.server.Server: Started @5540ms
[2023-04-23T13:47:44.787+0000] {subprocess.py:93} INFO - 23/04/23 13:47:43 INFO org.sparkproject.jetty.server.AbstractConnector: Started ServerConnector@5a7c66c3{HTTP/1.1, (http/1.1)}{0.0.0.0:35571}
[2023-04-23T13:47:49.877+0000] {subprocess.py:93} INFO - 23/04/23 13:47:45 INFO com.google.cloud.hadoop.repackaged.gcs.com.google.cloud.hadoop.gcsio.GoogleCloudStorageImpl: Ignoring exception of type GoogleJsonResponseException; verified object already exists with desired state.
[2023-04-23T13:47:54.574+0000] {subprocess.py:93} INFO - 23/04/23 13:47:52 WARN org.apache.spark.sql.catalyst.util.package: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.sql.debug.maxToStringFields'.
[2023-04-23T13:47:54.576+0000] {subprocess.py:93} INFO - Cleaning the data for the teams_df started
[2023-04-23T13:47:54.577+0000] {subprocess.py:93} INFO - Cleaning the data for the teams_df is successful!
[2023-04-23T13:47:57.384+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2023-04-23T13:47:57.385+0000] {subprocess.py:93} INFO -   File "/tmp/c46a0e44540e46869f8f684085c1ab08/transform_pyspark.py", line 125, in <module>
[2023-04-23T13:47:57.387+0000] {subprocess.py:93} INFO -     df_athletes.select(*columns_select)
[2023-04-23T13:47:57.388+0000] {subprocess.py:93} INFO -   File "/usr/lib/spark/python/lib/pyspark.zip/pyspark/sql/dataframe.py", line 1686, in selectExpr
[2023-04-23T13:47:57.390+0000] {subprocess.py:93} INFO -   File "/usr/lib/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py", line 1304, in __call__
[2023-04-23T13:47:57.391+0000] {subprocess.py:93} INFO -   File "/usr/lib/spark/python/lib/pyspark.zip/pyspark/sql/utils.py", line 117, in deco
[2023-04-23T13:47:57.392+0000] {subprocess.py:93} INFO - pyspark.sql.utils.AnalysisException: cannot resolve '`headshot`' given input columns: [age, birthPlace.city, birthPlace.country, birthPlace.state, dateOfBirth, debutYear, displayHeight, experience.years, firstName, fullName, headshot.href, height, id, lastName, position.id, position.name, shortName, status.name, teamId, weight]; line 1 pos 5;
[2023-04-23T13:47:57.394+0000] {subprocess.py:93} INFO - 'Project [cast(id#504 as int) AS athleteId#993, cast(firstName#508 as string) AS firstName#994, cast(lastName#509 as string) AS lastName#995, cast(fullName#510 as string) AS fullName#996, cast(shortName#512 as string) AS shortName#997, cast(weight#513 as double) AS weightLbs#998, cast(height#515 as double) AS heightInches#999, cast(age#517 as int) AS age#1000, cast(dateOfBirth#518 as date) AS dateOfBirth#1001, cast(debutYear#519 as int) AS debutYear#1002, cast(birthPlace.city#527 as string) AS birthPlaceCity#1003, cast(birthPlace.state#528 as string) AS birthPlaceState#1004, cast(birthPlace.country#555 as string) AS birthPlaceCountry#1005, cast(position.id#533 as int) AS positionId#1006, cast(position.name#534 as string) AS positionName#1007, cast(experience.years#542 as int) AS experienceYears#1008, cast(status.name#550 as string) AS statusName#1009, cast(teamId#553 as int) AS teamId#1010, cast('headshot as string) AS headshot#1011]
[2023-04-23T13:47:57.395+0000] {subprocess.py:93} INFO - +- Project [id#504, firstName#508, lastName#509, fullName#510, shortName#512, weight#513, height#515, displayHeight#516, age#517, dateOfBirth#518, debutYear#519, birthPlace.city#527, birthPlace.state#528, birthPlace.country#555, position.id#533, position.name#534, experience.years#542, status.name#550, teamId#553, headshot.href#530]
[2023-04-23T13:47:57.396+0000] {subprocess.py:93} INFO -    +- Relation[$ref#503,id#504,uid#505,guid#506,type#507,firstName#508,lastName#509,fullName#510,displayName#511,shortName#512,weight#513,displayWeight#514,height#515,displayHeight#516,age#517,dateOfBirth#518,debutYear#519,links#520,slug#521,jersey#522,injuries#523,linked#524,active#525,alternateIds.sdr#526,... 40 more fields] parquet
[2023-04-23T13:47:57.397+0000] {subprocess.py:93} INFO - 
[2023-04-23T13:47:57.398+0000] {subprocess.py:93} INFO - 23/04/23 13:47:56 INFO org.sparkproject.jetty.server.AbstractConnector: Stopped Spark@5a7c66c3{HTTP/1.1, (http/1.1)}{0.0.0.0:0}
[2023-04-23T13:48:09.485+0000] {subprocess.py:93} INFO - ERROR: (gcloud.dataproc.jobs.submit.pyspark) Job [c46a0e44540e46869f8f684085c1ab08] failed with error:
[2023-04-23T13:48:09.523+0000] {subprocess.py:93} INFO - Google Cloud Dataproc Agent reports job failure. If logs are available, they can be found at:
[2023-04-23T13:48:09.525+0000] {subprocess.py:93} INFO - https://console.cloud.google.com/dataproc/jobs/c46a0e44540e46869f8f684085c1ab08?project=nfl-project-de&region=europe-west6
[2023-04-23T13:48:09.527+0000] {subprocess.py:93} INFO - gcloud dataproc jobs wait 'c46a0e44540e46869f8f684085c1ab08' --region 'europe-west6' --project 'nfl-project-de'
[2023-04-23T13:48:09.530+0000] {subprocess.py:93} INFO - https://console.cloud.google.com/storage/browser/nfl-spark-staging_nfl-project-de/google-cloud-dataproc-metainfo/3f31be1a-ebc3-4b4c-987d-83767542db1e/jobs/c46a0e44540e46869f8f684085c1ab08/
[2023-04-23T13:48:09.532+0000] {subprocess.py:93} INFO - gs://nfl-spark-staging_nfl-project-de/google-cloud-dataproc-metainfo/3f31be1a-ebc3-4b4c-987d-83767542db1e/jobs/c46a0e44540e46869f8f684085c1ab08/driveroutput
[2023-04-23T13:48:12.373+0000] {subprocess.py:97} INFO - Command exited with return code 1
[2023-04-23T13:48:13.155+0000] {taskinstance.py:1776} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/decorators/base.py", line 217, in execute
    return_value = super().execute(context)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/operators/python.py", line 175, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/operators/python.py", line 192, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/data_ingestion.py", line 231, in task_pyspark
    operator.execute(context={})
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/operators/bash.py", line 196, in execute
    raise AirflowException(
airflow.exceptions.AirflowException: Bash command failed. The command returned a non-zero exit code 1.
[2023-04-23T13:48:13.574+0000] {taskinstance.py:1327} INFO - Marking task as UP_FOR_RETRY. dag_id=nfl_transformation_dag, task_id=task_pyspark, execution_date=20230411T000000, start_date=20230423T134721, end_date=20230423T134813
[2023-04-23T13:48:14.070+0000] {standard_task_runner.py:100} ERROR - Failed to execute job 1199 for task task_pyspark (Bash command failed. The command returned a non-zero exit code 1.; 4666)
[2023-04-23T13:48:14.517+0000] {local_task_job.py:212} INFO - Task exited with return code 1
[2023-04-23T13:48:14.815+0000] {taskinstance.py:2596} INFO - 0 downstream tasks scheduled from follow-on schedule check
